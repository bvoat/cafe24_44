<!--@layout(/layout/basic/layout.html)-->
<div module="layout_logincheck">
    <!--
        $url = /member/login.html
    -->
</div>

<!--@css(../css/module/myshop/module/index.css)-->
<article id="mypageWrap" class="mypage_wrap">
    <h1 class="displaynone">ë§ˆì´í˜ì´ì§€</h1>
    <section class="mypage_info_wrap" module="myshop_benefit">
        <h2 class="displaynone">ë‚´ ì •ë³´</h2>
        <input id="member_id" name="member_id" type="hidden" value="{$member_id}" />
        <section class="mypage_info_top">
            <ul class="mypage_info">
                <li class="myinfo_img" title="í”„ë¡œí•„ ì‚¬ì§„"><img src="https://bvoat.shop/images/new_img/ico__11.png" /></li>
                <li class="myinfo_txt" title="ë‹‰ë„¤ì„">
                    <div class="myinfo_name_wrap"><p class="nickname">{$member_name}</p> <p class="crew_icon displaynone"></p></div>
                    <p class="level">{$group_name}                    <input id="level_name" type="hidden" value="{$group_name}"></p>
                </li>
            </ul>
            <a class="mypage_modify" href="/member/modify.html">ë‚´ ì •ë³´ ìˆ˜ì •</a>
        </section>
        <section class="mypage_info_bottom" module="myshop_asyncbankbook">
            <ul class="mypage_info_menu">
                <li module="myshop_benefit">
                    <a href="/myshop/buy_records/list_my.html?member_id={$member_id}" title="ë‚˜ì˜ ì†Œë¹„ê¸°ë¡ ë³´ëŸ¬ê°€ê¸°">âœï¸ ë‚˜ì˜ ì†Œë¹„ê¸°ë¡<span><em class="buy_records_num"></em>ê±´ ì“¸ ìˆ˜ ìˆì–´ìš”</span>
                    </a>
                </li>
                <li>
                    <a title="ì¿ í° ë³´ëŸ¬ê°€ê¸°" href="/myshop/coupon/coupon.html">ğŸŸ ë³´ìœ í•œ ì¿ í°<span>{$coupon_cnt}ê°œ</span>
                    </a>
                </li>
            </ul>
        </section>
    </section>
    <section class="mypage_benefit_wrap" module="myshop_asyncbankbook">
        <h3 class="displaynone">ë‚´ê°€ ë°›ì€ í˜œíƒ</h3>
        <section class="mypage_benefit_top">
            <h3>ì‚¬ìš© ê°€ëŠ¥ ë§ˆì¼ë¦¬ì§€</h3>
            <p class="mypage_mileage">ğŸ’³   {$avail_mileage}</p>
            <a class="displaynone" href="/myshop/mileage/historyList.html" class="btnNormal">ì¡°íšŒ</a>
            <p class="mypage_mileage_txt">ë§ˆì¼ë¦¬ì§€ëŠ” ë¹„ë³´íŠ¸ ë‚´ì—ì„œ í˜„ê¸ˆì²˜ëŸ¼ ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        </section>
        <section class="mypage_benefit_bottom">
            <h3 class="displaynone">ê°€ì¹˜ ìŠ¤íƒ¬í”„</h3>
            <ul class="mypage_stamp_txt">
                <li>ê°€ì¹˜ ìŠ¤íƒ¬í”„</li>
                <li><em class="my_stamp_pcs"></em></li>
            </ul>
            <ol class="mypage_stamp_list stamp_list">
                <li><span class="stamp_node stamp0">1ê°œ</span></li>
                <li><span class="stamp_node stamp1">2ê°œ</span></li>
                <li><span class="stamp_node stamp2">3ê°œ</span></li>
                <li><span class="stamp_node stamp3">4ê°œ</span></li>
                <li><span class="stamp_node stamp4">5ê°œ</span></li>
            </ol>
        </section>
        <section class="mypage_stamp_info">
                <p class="voter_txt">ê°€ì¹˜ ìŠ¤íƒ¬í”„ 5ê°œë¥¼ ëª¨ìœ¼ë©´ <a href="/member/crew/crew.html" title="í¬ë£¨ ë“±ê¸‰ ì•ˆë‚´">í¬ë£¨ ë“±ê¸‰</a>ìœ¼ë¡œ ë“±ì—…ë©ë‹ˆë‹¤.
                </p>
                <p class="voter_txt_under">ê°€ì¹˜ ìŠ¤íƒ¬í”„ëŠ” ì§€ê¸‰ ë°›ì€ ì‹œì ìœ¼ë¡œë¶€í„° 30ì¼ì´ ê²½ê³¼ë˜ë©´ ì†Œë©¸ë©ë‹ˆë‹¤.</p>
                <p class="crew_txt displaynone"><em class="crew_end_date"></em>ê¹Œì§€ <a href="/member/crew/crew.html" title="í¬ë£¨ ë“±ê¸‰ ì•ˆë‚´">í¬ë£¨ ë“±ê¸‰</a>ìœ¼ë¡œ ê°€ì¹˜ë¥¼ ì¦ê¸¸ ìˆ˜ ìˆì–´ìš”!</p>
        </section>
    </section>
    <section class="mypage_menu_wrap">
        <ul class="mypage_menu">
            <li><a href="/myshop/order/list.html" title="ì£¼ë¬¸/ë°°ì†¡ ì¡°íšŒ">ì£¼ë¬¸/ë°°ì†¡ ì¡°íšŒ</a></li>
            <li><a href="/myshop/order/list.html?mode=cs" title="ì·¨ì†Œ/êµí™˜/ë°˜í’ˆ">ì·¨ì†Œ/êµí™˜/ë°˜í’ˆ</a></li>
            <li><a href="https://bvoat.channel.io" target="_blank" title="ë¹„ë³´íŠ¸ì—ê²Œ ë¬¸ì˜í•˜ê¸°">1:1 ë¬¸ì˜</a></li>
        </ul>
        <a class="mypage_logout" href="/exec/front/Member/logout/" target="_self" title="ë¡œê·¸ì•„ì›ƒ">ë¡œê·¸ì•„ì›ƒ</a>
    </section>
</article>

<script>

/* ë“±ê¸‰ í¬ë£¨ì¸ ê²½ìš° */
const crew_icon = document.querySelector(".crew_icon");
const voter_level = document.querySelector("#level_name");
let voter_identity = document.querySelector("#member_id").value;

/*  stamp ìˆ˜ì‹  */
//ìŠ¤íƒ¬í”„ ì´ë¯¸ì§€ DOM ì¶œë ¥ 
const displayStampImg = (stamp) => {
        //ìŠ¤íƒ¬í”„ í‘œì‹œ
        let stampList = document.querySelectorAll(".stamp_node");
        //ìŠ¤íƒ¬í”„ ì´ë¯¸ì§€ í‘œì‹œ
        let i = 0;
        if(Number.isInteger(stamp)){
            while(i < stamp){
                stampList[i].classList.add("whole_stamp");
                i++;
            }
        }else if(!Number.isInteger(stamp)){
            while(i < stamp){
                stampList[i].classList.add("whole_stamp");
                i++;
            }
            stampList[Math.floor(stamp)].classList.add("half_stamp");
        }
}
const reciveVoterStamp = (voter_level, voterID, displayStampImg) => {
    let stamp_node = document.querySelector(".my_stamp_pcs");
    if(voter_identity != null && voter_level != null){
        if(voter_level.value == "ì¼ë°˜ ë³´í„° "){    
            console.log('ì¼ë°˜ ë³´í„° ');      
            fetch(`https:///${api_domain}.shop/stamp?id=${voterID}`, {
            method: 'GET', // ë˜ëŠ” 'PUT'
            headers: {
                'Content-Type': 'application/json',
            },
            })
            .then((response) => response.json())
            .then((res) => {
                if(res.success){
                    let stamp_num = res.data.stamp;
                    console.log('stamp_num: ', stamp_num);
                    stamp_num < 5 ? stamp_node.insertAdjacentText("beforeend", `ğŸ™‚ ${stamp_num}ê°œ`) : stamp_num => 5 ? stamp_node.insertAdjacentText("beforeend",`ğŸ¥³ 5ê°œ`) : stamp_node.insertAdjacentText("beforeend",`ğŸ™‚ -ê°œ`);
                    displayStampImg(stamp_num)
                }
            })
            .catch((error) => {
            console.error('ì‹¤íŒ¨:', error);
            });     
        } else if (voter_level.value == "ë¹„ë³´íŠ¸ í¬ë£¨") {
            console.log('ë¹„ë³´íŠ¸ í¬ë£¨');
            //í¬ë£¨ ì•„ì´ì½˜ ë“±ì¥
            crew_icon.classList.remove("displaynone");
            stamp_num = 5;
            console.log('stamp_num: ', stamp_num);
            displayStampImg(stamp_num);
            stamp_node.insertAdjacentText("beforeend",`ğŸ¥³ 5ê°œ`)
        }
    }   
    return false;
}


/* ì†Œë¹„ê¸°ë¡ ìˆ˜ì‹  */
const buy_records_num = document.querySelector(".buy_records_num");

const reciveNotWriteBuyRecords = (voter_identity) => {
    if(voter_identity != null){
        fetch(`https://${api_domain}.shop/buy_records/data?div=not_write_cnt&member_id=${voter_identity}`, {
        method: 'GET', // ë˜ëŠ” 'PUT'
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        })
        .then((response) => response.json())
        .then((response) => {
            if(response || response.cnt){
                buy_records_num.insertAdjacentText("beforeend", response.cnt);
            } else {
                buy_records_num.insertAdjacentText("beforeend", "0");
            }
        })
        .catch((error) => {
        console.error('ì‹¤íŒ¨:', error);
        });    
    }
}




/* ìµœì¢… í•¨ìˆ˜ ì‹¤í–‰ */
//ìŠ¤íƒ¬í”„ ì¶œë ¥
reciveVoterStamp(voter_level, voter_identity,displayStampImg);
let not_write_cnt = reciveNotWriteBuyRecords(voter_identity)




</script>