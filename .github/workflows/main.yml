on: push
name: 🚀 Deploy Bvoat on push from web to mobile
jobs:
  web-deploy:
    name: 🎉 Deploy
    runs-on: ubuntu-latest
    timeout-minutes: 1000
    steps:
    - name: 🚚 Get latest code
      uses: actions/checkout@v2

    - name: 📂 Sync files mobile21
      uses: SamKirkland/FTP-Deploy-Action@4.3.0
      with:
        server: ${{ secrets.ACTION_FTP_HOST }}
        server-dir: /sde_design/mobile21/
        username: bvoatofficial
        password: ${{ secrets.ACTION_FTP_PWD }}
        protocol: ftp
        port: 21
        exclude: |
          **/.git*
          **/.git*/**
          **/node_modules/**
          **/.github*
          **/.github*/**
          **/preference*
          **/preference*/**
          *.json
          *.ini
          *.gif
          *.yml
          *.scss
          *.css.map

    - name: 📂 Sync files skin45
      uses: SamKirkland/FTP-Deploy-Action@4.3.0
      with:
        server: ${{ secrets.ACTION_FTP_HOST }}
        server-dir: /sde_design/skin45/
        username: bvoatofficial
        password: ${{ secrets.ACTION_FTP_PWD }}
        protocol: ftp
        port: 21
        exclude: |
          **/.git*
          **/.git*/**
          **/node_modules/**
          **/.github*
          **/.github*/**
          **/preference*
          **/preference*/**
          *.json
          *.ini
          *.gif
          *.yml
          *.scss
          *.css.map
          
    - name: Send FTP Result data to Passengers Slack 
      id: slack
      uses: slackapi/slack-github-action@v1.18.0
      with:
        # For posting a rich message using Block Kit
        payload: |
          {
            "text": "*[카페24 GitHub Action 배포🚀]* \n\n\n ${{github.event.workflow_run.name}}\n *GitHub Action 실행 결과 : * ${{ job.status }} \n *Pushed by : ${{ github.actor }}",
            "blocks": [
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "*[카페24 GitHub Action 배포🚀]* \n\n\n ${{github.event.workflow_run.name}}\n *GitHub Action 실행 결과 : * ${{ job.status }} \n *Pushed by : ${{ github.actor }}"
                }
            ]
          }
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.ACTION_SLACK_WEBHOOK_URL }}
        SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
