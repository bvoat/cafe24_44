<!--@layout(/layout/basic/layout.html)-->
<!--@css(/css/module/reviews/bvoat/feed.css)-->
<section id="reviewsWritableListWrap">
	<div id="reviewsWritableListTitle">
        <h2>리뷰 작성하고<br>
			<em>다른 보터들의 가치소비를 도와요.</em>
		</h2>
	</div>
    <div id="reviewsWritableListBox">
        <ul id="reviewsWritableList">
            
        </ul>
    </div>
    <p class="spinner displaynone"></p>
</section>
<script src="/js/module/reviews/common.js"></script>
<script>
    //접속 시 로그인 검사
    if (!sessionCheck("member_1")) {
        //미로그인 상태
        loginCheck("member_1");
    }

    //loading spinner 설정
    const loading = (condition) => {
        const spinner = document.querySelector(".spinner");
        condition ? spinner.classList.remove("displaynone") : spinner.classList.add("displaynone");
    }


    /** */
    function makeDOMforWritableList(data){
        data.forEach(data => {
            let seq = data.seq;
            console.log('seq: ', seq);
            let order_date = data.order_date_format;
            let mileage_by_level = data.level === 8 ? '1,000' : '200';
            let list_image = data.list_image;
            let prd_no = data.product_no;
            let prd_name = data.product_name;
            let prd_price = data.product_price;
            let prd_option = data.option_value;
            console.log('prd_option: ', prd_option);
            let option_over = data.option_value.length > 19 ? 'more' : '';
            console.log('prd_option_more: ', option_over);
            let member_id = data.member_id ? data.member_id : '';


            //DOM 추가
            document.querySelector("#reviewsWritableList")
                .insertAdjacentHTML("afterbegin",
                    `
                    <li id="writable_item_${seq}" class="reviews_writable_item" data-seq=${seq}>
                <div class="reviews_purchase_data">
                <p class="date">${order_date}</p>
                    <p class="mileage">마일리지 최대 <span class="mileage_by_level">${mileage_by_level}점</span></p>
                </div>
                <!-- 리뷰할 상품 정보 -->
                <section class="reviews_product">
                    <h1 class="displaynone">상품 리뷰하기</h1>
                        <div class="product_thumb thumb">
                            <a href="/product/detail.html?product_no=${prd_no}" title="${prd_name}">
                                <img src="${list_image}" alt="${prd_name}" onerror="this.src(${list_image})">
                            </a>
                        </div>
                    <ul class="product_info">
                        <li class="product_name" title="상품명">${prd_name}</li>
                        <li class="product_option ${option_over}" title="옵션"><span class="option ${option_over}">${prd_option}</span><button class="option_more">더보기</button></li>
                        <li class="product_price" title="상품가">${prd_price}원</li>
                    </ul>
                </section>
                <!-- 리뷰할 상품 정보 -->
                <a class="review_write_link" href="/reviews/write.html?seq=${seq}&member_id=${member_id}" data-seq=${seq}>✍️ 리뷰 기록하기</a>
            </li>`);
        });
    }
	/**
     * 최초 데이터 수신
    */
	function getWriteData() {
        let unwrittenReviewsData;
        //로딩 스피너 시작
        loading(true);
        console.log('login_userId: ', login_userId);
        fetch(`https://${api_domain}.shop/reviews/data?member_id=${login_userId}&div=not_write`, {
            
            method: "GET",
        })
        .then((response) => response.json())
        .then((response) => {
            unwrittenReviewsData = response.data;
            console.log('unwrittenReviewsData: ', unwrittenReviewsData);
            //로딩 스피너 종료
            loading(false);
            if(unwrittenReviewsData.length != 0){
                makeDOMforWritableList(unwrittenReviewsData);
            }else{
                document.querySelector("#reviewsWritableListBox").insertAdjacentHTML("afterbegin", `
                <div id="reviewsEmpty">
                    <h2 class="reviews_empty">게시물 없음</h2>
                    <p>아직 작성한 리뷰가 없어요</p>
                </div>
                `)
            }
        })
    }
    getWriteData();
	// window.addEventListener("DOMContentLoaded", loginCheck("member_1", "/reviews/write.html?seq=61736&member_id=wngud4950"))
</script>